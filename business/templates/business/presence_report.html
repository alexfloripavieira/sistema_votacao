{% extends 'base.html' %}

{% block title %}Relatório de Presenças - Avaí FC{% endblock %}

{% block content %}
<div class='min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 py-8'>
    <div class='max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'>
        <!-- Header -->
        <div class='flex justify-between items-center mb-8'>
            <div>
                <h1 class='text-3xl font-bold text-white mb-2'>Relatório de Presenças</h1>
                <p class='text-gray-400'>Visualize e filtre o histórico de presenças</p>
            </div>
            <a href='{% url "business:admin_dashboard" %}' class='text-gray-400 hover:text-white transition inline-flex items-center'>
                <svg class='w-5 h-5 mr-2' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                    <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M10 19l-7-7m0 0l7-7m-7 7h18'></path>
                </svg>
                Voltar ao Dashboard
            </a>
        </div>

        <!-- Statistics Cards -->
        <div class='grid grid-cols-1 md:grid-cols-3 gap-6 mb-8'>
            <div class='bg-gray-800 rounded-lg p-6 shadow-lg border-l-4 border-avai-green'>
                <div class='flex items-center justify-between'>
                    <div>
                        <p class='text-gray-400 text-sm'>Total de Presenças</p>
                        <p class='text-3xl font-bold text-white mt-2'>{{ total_presences }}</p>
                    </div>
                    <div class='bg-avai-green rounded-full p-3'>
                        <svg class='w-6 h-6 text-gray-900' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 13l4 4L19 7'></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class='bg-gray-800 rounded-lg p-6 shadow-lg border-l-4 border-red-600'>
                <div class='flex items-center justify-between'>
                    <div>
                        <p class='text-gray-400 text-sm'>Total de Ausências</p>
                        <p class='text-3xl font-bold text-white mt-2'>{{ total_absences }}</p>
                    </div>
                    <div class='bg-red-600 rounded-full p-3'>
                        <svg class='w-6 h-6 text-white' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 18L18 6M6 6l12 12'></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class='bg-gray-800 rounded-lg p-6 shadow-lg border-l-4 border-blue-600'>
                <div class='flex items-center justify-between'>
                    <div>
                        <p class='text-gray-400 text-sm'>Reuniões Registradas</p>
                        <p class='text-3xl font-bold text-white mt-2'>{{ unique_dates }}</p>
                    </div>
                    <div class='bg-blue-600 rounded-full p-3'>
                        <svg class='w-6 h-6 text-white' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter Form -->
        <div class='bg-gray-800 rounded-lg shadow-lg border border-gray-700 p-6 mb-6'>
            <h2 class='text-xl font-bold text-white mb-4'>Filtros</h2>
            <form method='get' class='grid grid-cols-1 md:grid-cols-3 gap-4'>
                <div>
                    <label for='start_date' class='block text-sm font-semibold text-gray-300 mb-2'>Data Início</label>
                    <input 
                        type='date' 
                        name='start_date' 
                        id='start_date'
                        value='{{ request.GET.start_date }}'
                        class='w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500'
                    >
                </div>
                <div>
                    <label for='end_date' class='block text-sm font-semibold text-gray-300 mb-2'>Data Fim</label>
                    <input 
                        type='date' 
                        name='end_date' 
                        id='end_date'
                        value='{{ request.GET.end_date }}'
                        class='w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500'
                    >
                </div>
                <div class='flex items-end'>
                    <button type='submit' class='w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg transition duration-200 font-semibold'>
                        Filtrar
                    </button>
                </div>
            </form>
        </div>

        <!-- Presences Table -->
        <div class='bg-gray-800 rounded-lg shadow-lg border border-gray-700 overflow-hidden'>
            <div class='overflow-x-auto'>
                <table class='w-full'>
                    <thead class='bg-gray-700'>
                        <tr>
                            <th class='px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider'>Usuário</th>
                            <th class='px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider'>Nome Completo</th>
                            <th class='px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider'>Data da Reunião</th>
                            <th class='px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider'>Status</th>
                            <th class='px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider'>Registrado em</th>
                        </tr>
                    </thead>
                    <tbody class='divide-y divide-gray-700'>
                        {% for presence in presences %}
                        <tr class='hover:bg-gray-700 transition'>
                            <td class='px-6 py-4 whitespace-nowrap'>
                                <div class='flex items-center'>
                                    <div class='bg-blue-600 rounded-full w-10 h-10 flex items-center justify-center text-white font-bold mr-3'>
                                        {{ presence.user.username.0|upper }}
                                    </div>
                                    <div class='text-sm text-white'>@{{ presence.user.username }}</div>
                                </div>
                            </td>
                            <td class='px-6 py-4 whitespace-nowrap text-sm text-gray-300'>
                                {{ presence.user.get_full_name|default:'-' }}
                            </td>
                            <td class='px-6 py-4 whitespace-nowrap text-sm text-gray-300'>
                                {{ presence.meeting.meeting_date|date:'d/m/Y' }}
                            </td>
                            <td class='px-6 py-4 whitespace-nowrap'>
                                {% if presence.present %}
                                <span class='bg-avai-green text-gray-900 text-xs font-semibold px-2 py-1 rounded-full'>
                                    Presente
                                </span>
                                {% else %}
                                <span class='bg-red-600 text-white text-xs font-semibold px-2 py-1 rounded-full'>
                                    Ausente
                                </span>
                                {% endif %}
                            </td>
                            <td class='px-6 py-4 whitespace-nowrap text-sm text-gray-400'>
                                {{ presence.created_at|date:'d/m/Y H:i' }}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan='5' class='px-6 py-8 text-center text-gray-400'>
                                Nenhuma presença registrada com os filtros selecionados.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pagination -->
        {% if is_paginated %}
        <div class='mt-6 flex justify-center'>
            <div class='flex space-x-2'>
                {% if page_obj.has_previous %}
                <a href='?page={{ page_obj.previous_page_number }}{% if request.GET.start_date %}&start_date={{ request.GET.start_date }}{% endif %}{% if request.GET.end_date %}&end_date={{ request.GET.end_date }}{% endif %}' 
                   class='bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition'>
                    Anterior
                </a>
                {% endif %}

                <span class='bg-gray-800 text-white px-4 py-2 rounded-lg border border-gray-700'>
                    Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
                </span>

                {% if page_obj.has_next %}
                <a href='?page={{ page_obj.next_page_number }}{% if request.GET.start_date %}&start_date={{ request.GET.start_date }}{% endif %}{% if request.GET.end_date %}&end_date={{ request.GET.end_date }}{% endif %}' 
                   class='bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition'>
                    Próxima
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
