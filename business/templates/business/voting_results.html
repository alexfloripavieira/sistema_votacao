{% extends 'base.html' %}

{% block title %}Resultados: {{ voting.title }} - Avaí FC{% endblock %}

{% block content %}
<div class='min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 py-8'>
    <div class='max-w-6xl mx-auto px-4 sm:px-6 lg:px-8'>
        <!-- Back Button -->
        <div class='mb-6'>
            <a href='{% url "business:voting_detail" voting.pk %}' class='text-gray-400 hover:text-white transition inline-flex items-center'>
                <svg class='w-5 h-5 mr-2' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                    <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M10 19l-7-7m0 0l7-7m-7 7h18'></path>
                </svg>
                Voltar para Votação
            </a>
        </div>

        <!-- Header -->
        <div class='bg-gray-800 rounded-lg shadow-lg border border-gray-700 p-8 mb-6'>
            <h1 class='text-3xl font-bold text-white mb-4'>Resultados da Votação</h1>
            <h2 class='text-2xl text-gray-300 mb-6'>{{ voting.title }}</h2>
            
            {% if voting.description %}
            <p class='text-gray-400 mb-6'>{{ voting.description }}</p>
            {% endif %}

            <div class='grid grid-cols-1 md:grid-cols-3 gap-4 mb-4 pb-4 border-b border-gray-700'>
                <div class='text-center'>
                    <div class='text-4xl font-bold text-avai-green mb-1'>{{ total_votes }}</div>
                    <div class='text-sm text-gray-400'>Total de Votos</div>
                </div>
                <div class='text-center'>
                    <div class='text-4xl font-bold text-blue-400 mb-1'>{{ options_data|length }}</div>
                    <div class='text-sm text-gray-400'>Opções</div>
                </div>
                <div class='text-center'>
                    {% if voting.is_open %}
                    <div class='text-4xl font-bold text-avai-green mb-1'>●</div>
                    <div class='text-sm text-gray-400'>Em Andamento</div>
                    {% else %}
                    <div class='text-4xl font-bold text-gray-400 mb-1'>●</div>
                    <div class='text-sm text-gray-400'>Encerrada</div>
                    {% endif %}
                </div>
            </div>
        </div>

        {% if can_view_results %}
        <!-- Results -->
        <div class='space-y-6'>
            {% for data in options_data %}
            <div class='bg-gray-800 rounded-lg shadow-lg border border-gray-700 p-6'>
                <!-- Option Header -->
                <div class='flex items-center justify-between mb-4'>
                    <h3 class='text-2xl font-bold text-white'>
                        Opção {{ data.option.option_letter }}: {{ data.option.option_text }}
                    </h3>
                    <div class='text-right'>
                        <div class='text-3xl font-bold text-avai-green'>{{ data.option.votes_count }}</div>
                        <div class='text-sm text-gray-400'>voto{{ data.option.votes_count|pluralize }}</div>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class='mb-6'>
                    <div class='bg-gray-700 rounded-full h-4 overflow-hidden'>
                        <div class='bg-avai-green h-full transition-all duration-500' style='width: {{ data.percentage }}%'></div>
                    </div>
                    <div class='text-right text-sm text-gray-400 mt-1'>{{ data.percentage|floatformat:1 }}%</div>
                </div>

                <!-- Voters List -->
                {% if data.votes %}
                <div class='border-t border-gray-700 pt-4'>
                    <h4 class='text-lg font-semibold text-gray-300 mb-3'>Votantes ({{ data.votes.count }})</h4>
                    <div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3'>
                        {% for vote in data.votes %}
                        <div class='bg-gray-700 rounded-lg p-3 flex items-center space-x-3'>
                            <div class='bg-blue-600 rounded-full w-10 h-10 flex items-center justify-center text-white font-bold'>
                                {{ vote.user.username.0|upper }}
                            </div>
                            <div class='flex-1'>
                                <div class='text-white font-semibold'>{{ vote.user.get_full_name|default:vote.user.username }}</div>
                                <div class='text-xs text-gray-400'>@{{ vote.user.username }}</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% else %}
                <div class='text-center text-gray-400 py-4'>
                    Nenhum voto registrado nesta opção
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <!-- Staff Actions -->
        {% if user.is_staff %}
        <div class='mt-8 bg-gray-800 rounded-lg shadow-lg border border-gray-700 p-6'>
            <h3 class='text-xl font-bold text-white mb-4'>Ações Administrativas</h3>
            <div class='flex space-x-4'>
                <a href='{% url "business:voting_report" voting.pk %}' class='bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition duration-200 font-semibold'>
                    Ver Relatório Completo
                </a>
                <a href='/admin/business/voting/{{ voting.pk }}/change/' target='_blank' class='bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition duration-200 font-semibold'>
                    Editar no Admin
                </a>
            </div>
        </div>
        {% endif %}

        {% else %}
        <!-- Access Denied -->
        <div class='bg-yellow-900/20 border border-yellow-500 rounded-lg p-8 text-center'>
            <svg class='w-16 h-16 text-yellow-500 mx-auto mb-4' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z'></path>
            </svg>
            <h3 class='text-xl font-semibold text-yellow-400 mb-2'>Acesso Restrito</h3>
            <p class='text-gray-300 mb-6'>
                Você precisa votar nesta votação para ver os resultados detalhados.
            </p>
            <a href='{% url "business:voting_detail" voting.pk %}' class='inline-block bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition duration-200 font-semibold'>
                Ir para Votação
            </a>
        </div>
        {% endif %}
    </div>
</div>

<script>
// Auto refresh every 30 seconds if voting is still open
{% if voting.is_open %}
setTimeout(function() {
    location.reload();
}, 30000);
{% endif %}
</script>
{% endblock %}
